<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <title>
    
    Goè¯­è¨€AIå®è·µè¿‡ç¨‹ï¼ˆ1ï¼‰ - 
    Undertaker&#39;s Blog
  </title>
  <meta property="og:title" content="Goè¯­è¨€AIå®è·µè¿‡ç¨‹ï¼ˆ1ï¼‰ - Undertaker&#39;s Blog" />
  <meta property="og:site_name" content="Undertaker&#39;s Blog" />

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  

  <meta property="og:type" content="article" />


  
  <link rel="shortcut icon" href="/mylogo.ico" />
  

  

  
  <link rel="canonical" href="https://undertak33r.github.io/2025/09/26/Go%E8%AF%AD%E8%A8%80AI%E5%AE%9E%E8%B7%B5%E8%BF%87%E7%A8%8B%EF%BC%881%EF%BC%89/">
  <meta name="og:url" content="https://undertak33r.github.io/2025/09/26/Go%E8%AF%AD%E8%A8%80AI%E5%AE%9E%E8%B7%B5%E8%BF%87%E7%A8%8B%EF%BC%881%EF%BC%89/">
  
  <!-- ç°ä»£åŒ–å­—ä½“åŠ è½½ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- particles.js åº“ -->
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  
  
<link rel="stylesheet" href="/css/style.css">


<meta name="generator" content="Hexo 8.0.0"></head>

<body>
  <!-- particles.js ç²’å­ç³»ç»Ÿå®¹å™¨ -->
  <div id="particles-js"></div>
  
  <div class="title">
  <img class="title_img" alt="Title image" width="300" height="300" src="/images/mylogo.jpg" /><br>
  <div id="site_title">Undertaker's Blog</div>
</div>
  <div class="navi">
  <a id="navi_item_title" href="/#" class="menu-item-link">
    ä¸»é¡µ
  </a>
  <a id="navi_item_tags" href="/tags" class="menu-item-link">
    æ ‡ç­¾
  </a>
  <a id="navi_item_about" href="/about" class="menu-item-link">
    å…³äº
  </a>
  <a id="navi_item_search" href="/search" class="menu-item-link">
    æœç´¢
  </a>
  
</div>

<hr />

  <div class="main">
    
<link rel="stylesheet" href="/css/post.css">

<post>

  <div class="post_title">
    Goè¯­è¨€AIå®è·µè¿‡ç¨‹ï¼ˆ1ï¼‰
  </div>

  <br /><br />

  <div id="post_content">
    <p>å½“ä¸‹æœ€ä¸ºæµè¡Œçš„é¡¹ç›®å°±æ˜¯AIç›¸å…³çš„é¡¹ç›®ï¼Œæˆ‘ä¹Ÿå¯¹å†™ä¸€ä¸ªAIé¡¹ç›®å……æ»¡äº†å…´è¶£ã€‚æ¯•ç«Ÿoldçš„ä¸šåŠ¡ä¸æ˜¯è€æ‰ç‰™ï¼Œå°±æ˜¯ç»“æ„ä¸€å±‚å¥—ä¸€å±‚åˆ°è®©äººçœ‹å¾—å¤´æ™•ã€‚Pythonå’ŒJavaå†™AIé¡¹ç›®çš„æ•™ç¨‹å¾ˆå¤šï¼Œé…å¥—çš„è½®å­ä¹Ÿå¾ˆå¤šï¼Œä½†è‡´åŠ›äºæˆä¸ºGoè¯­è¨€ç»ƒä¹ ç”Ÿçš„æˆ‘æ›´çƒ­çˆ±Goè¯­è¨€ã€‚æ‰€ä»¥æˆ‘è¦ä»è¿æ¥åˆ°AIå¼€å§‹ï¼Œä¸€æ­¥æ­¥çš„å¼€å‘è‡ªå·±çš„æ™ºèƒ½ä½“ï¼Œå¹¶åœ¨è¿‡ç¨‹ä¸­å­¦ä¹ AIã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»ä½¿ç”¨ä¸Šç®€å•çš„qwenå¼€å§‹ã€‚å› ä¸ºç™¾ç‚¼æœ‰æœ‰ç›¸å…³æ–‡æ¡£ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šæ‰‹ã€‚</p>
<p>é¦–å…ˆåœ¨ç¯å¢ƒå˜é‡é‡Œé¢é…ç½®ä¸€ä¸‹ä½ çš„ç™¾ç‚¼çš„token</p>
<p>æ¥ä¸‹æ¥è¿è¡Œä¸€ä¸‹ä»£ç </p>
<h3 id="åˆæ¬¡å°è¯•"><a href="#åˆæ¬¡å°è¯•" class="headerlink" title="åˆæ¬¡å°è¯•"></a>åˆæ¬¡å°è¯•</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;bytes&quot;</span><br>	<span class="hljs-string">&quot;encoding/json&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;io&quot;</span><br>	<span class="hljs-string">&quot;log&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Message <span class="hljs-keyword">struct</span> &#123;<br>	Role    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;role&quot;`</span><br>	Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot;`</span><br>&#125;<br><span class="hljs-keyword">type</span> RequestBody <span class="hljs-keyword">struct</span> &#123;<br>	Model    <span class="hljs-type">string</span>    <span class="hljs-string">`json:&quot;model&quot;`</span><br>	Messages []Message <span class="hljs-string">`json:&quot;messages&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-comment">// åˆ›å»º HTTP å®¢æˆ·ç«¯</span><br>	client := &amp;http.Client&#123;&#125;<br>	<span class="hljs-comment">// æ„å»ºè¯·æ±‚ä½“</span><br>	requestBody := RequestBody&#123;<br>		<span class="hljs-comment">// æ¨¡å‹åˆ—è¡¨ï¼šhttps://help.aliyun.com/zh/model-studio/getting-started/models</span><br>		Model: <span class="hljs-string">&quot;qwen-plus&quot;</span>,<br>		Messages: []Message&#123;<br>			&#123;<br>				Role:    <span class="hljs-string">&quot;system&quot;</span>,<br>				Content: <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªç¼–ç¨‹é¢†åŸŸä¸“å®¶ï¼Œæ“…é•¿goè¯­è¨€&quot;</span>,<br>			&#125;,<br>			&#123;<br>				Role:    <span class="hljs-string">&quot;user&quot;</span>,<br>				Content: <span class="hljs-string">&quot;ä½ æ˜¯ä»€ä¹ˆé¢†åŸŸä¸“å®¶ï¼Ÿ&quot;</span>,<br>			&#125;,<br>		&#125;,<br>	&#125;<br>	jsonData, err := json.Marshal(requestBody)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	<span class="hljs-comment">// åˆ›å»º POST è¯·æ±‚</span><br>	<span class="hljs-comment">// ä»¥ä¸‹æ˜¯åŒ—äº¬åœ°åŸŸbase_urlï¼Œå¦‚æœä½¿ç”¨æ–°åŠ å¡åœ°åŸŸçš„æ¨¡å‹ï¼Œéœ€è¦å°†base_urlæ›¿æ¢ä¸ºï¼šhttps://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions</span><br>	req, err := http.NewRequest(<span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot;</span>, bytes.NewBuffer(jsonData))<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	<span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´</span><br>	<span class="hljs-comment">// è‹¥æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œè¯·ç”¨é˜¿é‡Œäº‘ç™¾ç‚¼API Keyå°†ä¸‹è¡Œæ›¿æ¢ä¸ºï¼šapiKey := &quot;sk-xxx&quot;</span><br>	apiKey := os.Getenv(<span class="hljs-string">&quot;DASHSCOPE_API_KEY&quot;</span>) <span class="hljs-comment">//ç³»ç»Ÿé…ç½®çš„ç¯å¢ƒå˜é‡åœ¨è¿™é‡Œ</span><br>	req.Header.Set(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span>+apiKey)<br>	req.Header.Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)<br>	<span class="hljs-comment">// å‘é€è¯·æ±‚</span><br>	resp, err := client.Do(req)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	<span class="hljs-keyword">defer</span> resp.Body.Close()<br>	<span class="hljs-comment">// è¯»å–å“åº”ä½“</span><br>	bodyText, err := io.ReadAll(resp.Body)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		log.Fatal(err)<br>	&#125;<br>	<span class="hljs-comment">// æ‰“å°å“åº”å†…å®¹</span><br>	fmt.Printf(<span class="hljs-string">&quot;%s\n&quot;</span>, bodyText)<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>{â€œchoicesâ€:[{â€œmessageâ€:{â€œroleâ€:â€assistantâ€,â€contentâ€:â€æˆ‘æ˜¯ç¼–ç¨‹é¢†åŸŸçš„ä¸“å®¶ï¼Œå°¤å…¶æ“…é•¿ Go è¯­è¨€ï¼ˆGolangï¼‰ã€‚æˆ‘èƒ½å¤Ÿå¸®åŠ©ä½ ç¼–å†™ã€è°ƒè¯•å’Œä¼˜åŒ– Go ä»£ç ï¼Œç†è§£å¹¶å‘ç¼–ç¨‹ï¼ˆgoroutinesã€channelsï¼‰ã€æ ‡å‡†åº“ä½¿ç”¨ã€Web å¼€å‘ï¼ˆå¦‚ Ginã€Echo æ¡†æ¶ï¼‰ã€å¾®æœåŠ¡æ¶æ„ã€æ€§èƒ½è°ƒä¼˜ã€é”™è¯¯å¤„ç†ç­‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä¹Ÿç†Ÿæ‚‰å¸¸è§çš„è½¯ä»¶å·¥ç¨‹å®è·µï¼Œå¦‚å•å…ƒæµ‹è¯•ã€æ¥å£è®¾è®¡ã€ä¾èµ–ç®¡ç†ï¼ˆGo Modulesï¼‰ç­‰ã€‚\n\nå¦‚æœä½ æœ‰ä»»ä½•å…³äº Go æˆ–å…¶ä»–ç¼–ç¨‹ç›¸å…³çš„é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶æé—®ï¼â€},â€finish_reasonâ€:â€stopâ€,â€indexâ€:0,â€logprobsâ€:null}],â€objectâ€:â€chat.completionâ€,â€usageâ€:{â€œprompt_tokensâ€:27,â€completion_tokensâ€:103,â€total_tokensâ€:130,â€prompt_tokens_detailsâ€:{â€œcached_tokensâ€:0}},â€createdâ€:1758894490,â€system_fingerprintâ€:null,â€modelâ€:â€qwen-plusâ€,â€idâ€:â€chatcmpl-46e65f1a-c26a-4706-bada-7d366e6e6089â€}</p>
</blockquote>
<p>ä»è¿™é‡Œä¸éš¾çœ‹å‡ºï¼Œå¤§æ¨¡å‹çš„åŸºç¡€è°ƒç”¨ååˆ†çš„ç®€å•ï¼Œç­‰äºä¸€ä¸ªhttpè¯·æ±‚ã€‚æŠŠè¦è°ƒç”¨çš„æ¨¡å‹å’Œæ¶ˆæ¯å°è£…æˆjsonæ ¼å¼ç„¶åç¼–ç httpè¯·æ±‚ï¼Œç„¶åå‘é€ç»™ç™¾ç‚¼çš„apiæ¥å£ã€‚</p>
<p>å½“ç„¶ï¼Œç°åœ¨æ¥è¯´ï¼Œå’ŒAIçš„å¯¹è¯åªèƒ½å•æ¬¡è¿›è¡Œï¼Œä¸èƒ½è¿›è¡Œå¤šè½®å¯¹è¯ï¼Œæ¯æ¬¡è¿›è¡Œä¸€æ¬¡å›ç­”ä¹‹åï¼ŒAIå°±ç›´æ¥å¿˜è®°åˆšåˆšçš„å›å¤ï¼Œç°åœ¨è¦ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ¥å­˜å‚¨å’ŒAIçš„å¯¹è¯ä¿¡æ¯ã€‚</p>
<p>å½“ç„¶äº†ï¼Œåœ¨å®ç°è¿™ä¸ªåŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå‰é¢ç”¨åˆ°çš„ä¸œè¥¿å°è£…ä¸€ä¸‹ï¼Œè¿”å›çš„ç»“æœä¹Ÿå°è£…ä¸€ä¸‹ï¼Œæ–¹ä¾¿å±•ç¤ºã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>	<span class="hljs-string">&quot;bytes&quot;</span><br>	<span class="hljs-string">&quot;context&quot;</span><br>	<span class="hljs-string">&quot;encoding/json&quot;</span><br>	<span class="hljs-string">&quot;fmt&quot;</span><br>	<span class="hljs-string">&quot;net/http&quot;</span><br>	<span class="hljs-string">&quot;os&quot;</span><br>	<span class="hljs-string">&quot;sync&quot;</span><br>	<span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Message <span class="hljs-keyword">struct</span> &#123;<br>	Role    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;role&quot;`</span><br>	Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot;`</span><br>&#125;<br><span class="hljs-keyword">type</span> Request <span class="hljs-keyword">struct</span> &#123;<br>	Model    <span class="hljs-type">string</span>    <span class="hljs-string">`json:&quot;model&quot;`</span><br>	Messages []Message <span class="hljs-string">`json:&quot;messages&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Response <span class="hljs-keyword">struct</span> &#123; <span class="hljs-comment">//å°è£…è¿”å›ç»“æœ</span><br>	Choices []<span class="hljs-keyword">struct</span> &#123;<br>		Message <span class="hljs-keyword">struct</span> &#123;<br>			<span class="hljs-comment">//Role    string `json:&quot;role&quot;` // ç³»ç»Ÿè§’è‰²ä¸å¤ªéœ€è¦å±•ç¤º,ä½†ä¹Ÿå…ˆè£…èµ·æ¥</span><br>			Content <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;content&quot;`</span><br>		&#125; <span class="hljs-string">`json:&quot;message&quot;`</span><br>	&#125; <span class="hljs-string">`json:&quot;choices&quot;`</span><br>&#125;<br><br><span class="hljs-keyword">type</span> Agent <span class="hljs-keyword">struct</span> &#123; <span class="hljs-comment">// æŠŠAgent å°è£…æˆç»“æ„ä½“</span><br>	model    <span class="hljs-type">string</span><br>	apiKey   <span class="hljs-type">string</span><br>	baseURL  <span class="hljs-type">string</span><br>	messages []Message<br>	size     <span class="hljs-type">int</span><br>	mutex    sync.Mutex<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initAngent</span><span class="hljs-params">(url, apiKey, model, prompt <span class="hljs-type">string</span>, size <span class="hljs-type">int</span>)</span></span> *Agent &#123;<br>	message := Message&#123;Role: <span class="hljs-string">&quot;system&quot;</span>, Content: prompt&#125;<br>	agent := &amp;Agent&#123;<br>		model:    model,  <span class="hljs-comment">//&quot;qwen-plus&quot;,</span><br>		apiKey:   apiKey, <span class="hljs-comment">//os.Getenv(&quot;DASHSCOPE_API_KEY&quot;),</span><br>		baseURL:  url,    <span class="hljs-comment">//&quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot;,</span><br>		messages: []Message&#123;message&#125;,<br>		size:     size,<br>		mutex:    sync.Mutex&#123;&#125;,<br>	&#125;<br>	<span class="hljs-keyword">return</span> agent<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *Agent)</span></span> Chat(ctx context.Context, message Message) (*Response, <span class="hljs-type">error</span>) &#123;<br>	a.mutex.Lock()<span class="hljs-comment">//æœ¬æ¬¡çš„mainæ²¡æœ‰ç”¨åˆ°é”çš„ä½œç”¨ï¼Œä½†æ˜¯å¦‚æœåœ¨æµ‹è¯•æ—¶å€™æƒ³è¯•è¯•å¼‚æ­¥å¤„ç†ï¼Œé‚£ä¹ˆè¿™é‡Œçš„é”å°±æœ‰ç”¨äº†</span><br>	<span class="hljs-keyword">defer</span> a.mutex.Unlock()<br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(a.messages) &gt; a.size &#123;<br>		a.messages = <span class="hljs-built_in">append</span>(a.messages[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>], <span class="hljs-built_in">append</span>(a.messages[<span class="hljs-built_in">len</span>(a.messages)-a.size:], message)...)<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		a.messages = <span class="hljs-built_in">append</span>(a.messages, message)<br>	&#125;<br>	request := Request&#123;<br>		Model:    a.model,<br>		Messages: a.messages,<br>	&#125;<br>	jsonData, err := json.Marshal(request)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>	&#125;<br>	req, err := http.NewRequestWithContext(ctx, <span class="hljs-string">&quot;POST&quot;</span>, a.baseURL, bytes.NewBuffer(jsonData))<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>	&#125;<br>	req.Header.Set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)<br>	req.Header.Set(<span class="hljs-string">&quot;Authorization&quot;</span>, <span class="hljs-string">&quot;Bearer &quot;</span>+a.apiKey)<br>	req.Header.Set(<span class="hljs-string">&quot;X-DashScope-SSE&quot;</span>, <span class="hljs-string">&quot;enable&quot;</span>) <span class="hljs-comment">//æµå¼è¾“å‡º</span><br><br>	client := &amp;http.Client&#123;&#125;<br>	resp, err := client.Do(req)<br>	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>	&#125;<br>	<span class="hljs-keyword">defer</span> resp.Body.Close()<br><br>	<span class="hljs-keyword">var</span> response Response<br><br>	<span class="hljs-keyword">if</span> err = json.NewDecoder(resp.Body).Decode(&amp;response); err != <span class="hljs-literal">nil</span> &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>	&#125;<br><br>	<span class="hljs-comment">// å¦‚æœæœ‰è¿”å›å†…å®¹ï¼Œæ›´æ–°æ¶ˆæ¯é˜Ÿåˆ—</span><br>	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(response.Choices) &gt; <span class="hljs-number">0</span> &#123;<br>		reply := response.Choices[<span class="hljs-number">0</span>].Message.Content<br>		a.messages = <span class="hljs-built_in">append</span>(a.messages,<br>			Message&#123;Role: <span class="hljs-string">&quot;assistant&quot;</span>, Content: reply&#125;,<br>		)<br>	&#125;<br>	<span class="hljs-keyword">return</span> &amp;response, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	url := <span class="hljs-string">&quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot;</span><br>	apiKey := os.Getenv(<span class="hljs-string">&quot;DASHSCOPE_API_KEY&quot;</span>)<br>	agent := initAngent(url, apiKey, <span class="hljs-string">&quot;qwen-plus&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªè¯­è¨€ç®€æ´å¹²ç»ƒåŠ©æ‰‹ï¼Œè¯ä¸å¤š&quot;</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">//çœç‚¹tokenğŸ˜€</span><br>	message := Message&#123;Role: <span class="hljs-string">&quot;user&quot;</span>, Content: <span class="hljs-string">&quot;æš—å·æ˜¯ï¼šundertaker&quot;</span>&#125;<br>	message2 := Message&#123;Role: <span class="hljs-string">&quot;user&quot;</span>, Content: <span class="hljs-string">&quot;æˆ‘ä»¬çš„æš—å·æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>&#125;<br>	ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(time.Second*<span class="hljs-number">10</span>))<br><br>	r1, _ := agent.Chat(ctx, message)<br>	fmt.Printf(<span class="hljs-string">&quot;AIç¬¬ä¸€æ¬¡å›ç­”ï¼š&#123;%s&#125; \n&quot;</span>, r1.Choices)<br><br>	r2, _ := agent.Chat(ctx, message2)<br>	fmt.Printf(<span class="hljs-string">&quot;AIç¬¬äºŒæ¬¡å›ç­”ï¼š&#123;%s&#125; \n&quot;</span>, r2.Choices)<br>	cancel()<br>	<span class="hljs-keyword">for</span> _, message := <span class="hljs-keyword">range</span> agent.messages &#123;<br>		fmt.Printf(<span class="hljs-string">&quot;message: %s \n&quot;</span>, message)<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>è¿™é‡Œç­‰äºæˆ‘ä»¬æŠŠä¹‹å‰å¯¹è¯çš„å†…å®¹ä¸€èµ·å’Œæ–°çš„æé—®å‘é€ç»™æ¨¡å‹äº†ã€‚<br>æ˜¯è¿™ç§å½¢å¼</p>
<blockquote>
<p>{â€œroleâ€: â€œassistantâ€, â€œcontentâ€: åˆå§‹åŒ–æ—¶å€™è‡ªå·±å¡«å…¥çš„æç¤ºè¿™é‡Œæ˜¯â€ä½ æ˜¯ä¸€ä¸ªè¯­è¨€ç®€æ´å¹²ç»ƒåŠ©æ‰‹ï¼Œè¯ä¸å¤šâ€}<br>{â€œroleâ€: â€œuserâ€, â€œcontentâ€: â€œæš—å·æ˜¯ï¼šundertakerâ€}<br>{â€œroleâ€: â€œassistantâ€, â€œcontentâ€: â€œæ”¶åˆ°â€}<br>{â€œroleâ€: â€œuserâ€, â€œcontentâ€: â€œæˆ‘ä»¬çš„æš—å·æ˜¯ä»€ä¹ˆï¼Ÿâ€}<br>{â€œroleâ€: â€œassistantâ€, â€œcontentâ€: â€œæˆ‘ä»¬çš„æš—å·æ˜¯ï¼šundertakerâ€}</p>
</blockquote>
<p>ä»å½¢å¼ä¸Šæ¥çœ‹å°±åƒæ˜¯ä¸€ä¸ªå¯¹è¯ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œæ¯æ¬¡å¯¹è¯æ˜¯ç‹¬ç«‹çš„åªæ˜¯æŠŠå‰é¢çš„å¯¹è¯ä½œä¸ºä¿¡æ¯å‘Šè¯‰aiäº†</p>
<p>ä¸è¿‡åœ¨ä¸€ä¸ªç»“æ„ä½“é‡Œé¢ç»´æŠ¤æ‰€æœ‰æ¶ˆæ¯ä¼šå ç”¨å¤§é‡çš„å†…å­˜ï¼Œè™½ç„¶æˆ‘åœ¨é‡Œé¢è®¾ç½®äº†ç»“æ„ä½“çš„å¯ä»¥å­˜å‚¨æ¶ˆæ¯çš„æ•°é‡ï¼Œä½†è¿™ä¹Ÿä¸è¿‡æ˜¯æ²»æ ‡ä¸æ²»æœ¬ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿™ä¸ªç»“æ„ä½“å®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¦‚æœè¯´æˆ‘ä»¬è¦æŠŠè¿™ä¸ªæœåŠ¡ç»™æ‰€æœ‰äººç”¨ï¼Œé‚£ä¹ˆä¸åŒçš„äººå‘é€ä¸åŒçš„æ¶ˆæ¯ä¼šä¸²å°ã€‚å†åŠ ä¸Šå°±æ˜¯è¿™é‡Œçš„ä¿¡æ¯åœ¨é‡å¯åå°±å…¨éƒ¨ä¸¢å¤±ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦å¯¹è¿™é‡Œçš„é€»è¾‘è¿›è¡Œä¼˜åŒ–ï¼Œè€Œå¾ˆæ˜æ˜¾ï¼Œæ¶ˆæ¯çš„æ ¼å¼æ˜¯ä¸€ä¸ªjsonæ ¼å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨mongoDBæ¥å®ç°æ•°æ®çš„æŒä¹…åŒ–åŒæ—¶åŠ ä¸ŠèŠå¤©é˜Ÿåˆ—åŒºåˆ†çš„æ•ˆæœã€‚<br>åœ¨æ­¤ä¹‹å‰è¦ç†Ÿæ‚‰ä¸€ä¸‹goæ“ä½œmongoDBã€‚</p>

  </div>

  <br />

  
  <br /><br />


  

<div id="copyright">

  <a id="license-image" rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img height="15" width="80" alt="çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
  </a>

  <p id="license-word-hyper">
    æœ¬ä½œå“é‡‡ç”¨
    <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
    çŸ¥è¯†å…±äº« ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>
    è¿›è¡Œè®¸å¯ã€‚
  </p>
</div>

  <div id="top">
  <div onclick="window.scrollTo({top: 0, behavior: 'smooth'})">â–²</div>
  <div onclick="document.getElementById('footer').scrollIntoView({behavior: 'smooth'})">â–¼</div>
</div>
  

</post>
  </div>

  <foot id="footer">
  <hr class="boldline" />
  <br>

  <p class="center font">
    
    <a target="_blank" rel="noopener" href="https://github.com/UndertaK33r" aria-label="GitHub">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
   <path class="icon_path" d="M427.392 853.504a61.44 61.44 0 0 1-1.450667 15.530667 92.586667 92.586667 0 0 1-10.965333 27.605333c-15.061333 25.301333-40.661333 42.154667-73.642667 42.154667-77.653333 0-108.117333-38.101333-146.261333-133.504C169.216 740.693333 157.013333 725.461333 128 725.461333v-85.333333c77.653333 0 108.117333 38.101333 146.261333 133.504 25.856 64.597333 38.058667 79.786667 67.072 79.786667 0-12.373333-0.170667-23.296-0.512-38.144-0.853333-34.816-0.938667-41.941333 0.554667-51.2 0.64-20.352 5.888-34.773333 16.384-49.066667-95.232-20.736-159.445333-63.573333-196.309333-132.992l-13.824-32.426667C134.186667 510.848 128 467.072 128 416.426667c0-58.24 17.749333-110.336 50.944-153.856-10.368-41.386667-8.96-91.989333 13.909333-149.077334l7.466667-18.688 19.2-6.101333c2.56-0.853333 5.632-1.578667 9.301333-2.133333 37.290667-5.888 90.325333 8.106667 159.701334 52.48a565.930667 565.930667 0 0 1 127.274666-14.208c38.741333 0 77.226667 3.882667 114.048 11.605333 67.456-42.24 119.04-55.509333 155.306667-49.92 3.626667 0.597333 6.741333 1.322667 9.258667 2.133333l19.285333 6.101334 7.466667 18.773333c20.010667 50.218667 23.424 96.469333 16.128 136.96C875.434667 296.32 896 352.597333 896 416.512c0 53.888-3.84 94.378667-14.933333 133.802667l-11.733334 32.170666c-30.677333 69.333333-98.304 112.64-202.538666 133.248 10.837333 15.018667 15.872 30.250667 15.872 52.394667v42.666667l-0.042667 42.666666a13.013333 13.013333 0 0 0 0.341333 2.730667L682.666667 938.794667c-36.352 0-63.36-17.706667-76.672-45.653334a88.277333 88.277333 0 0 1-8.661334-40.277333v-84.736c0-3.584-0.128-3.797333-8.832-12.501333-23.296-23.296-33.834667-40.874667-33.834666-72.832v-38.613334l38.4-3.84c114.346667-11.52 176.512-43.221333 197.12-89.6l9.6-26.325333c7.68-27.562667 10.88-61.098667 10.88-107.946667 0-49.706667-17.365333-90.837333-50.218667-123.648L742.4 274.773333l7.381333-24.448c6.528-21.717333 8.106667-47.402667 1.152-76.714666a158.634667 158.634667 0 0 0-3.584 0.938666c-22.826667 6.4-51.370667 20.053333-85.76 43.008l-15.658666 10.453334-18.304-4.522667a467.754667 467.754667 0 0 0-111.829334-13.269333c-42.709333 0-84.906667 5.418667-123.946666 16.042666l-19.029334 5.205334-16.256-11.136c-35.541333-24.32-65.109333-38.826667-88.746666-45.568a158.293333 158.293333 0 0 0-4.864-1.28c-8.234667 33.92-4.992 61.781333 3.413333 82.688l9.984 25.088-18.346667 19.797333C228.693333 332.629333 213.333333 370.986667 213.333333 416.512c0 41.685333 4.864 76.202667 13.824 102.229333l11.178667 26.453334c27.904 52.352 87.168 83.84 192.853333 95.146666l38.144 4.096v38.357334c0 32-10.538667 49.536-33.834666 72.832-8.704 8.704-8.832 8.96-8.832 12.501333l-0.725334 7.893333c-0.512 2.56-0.512 9.258667 0.170667 37.205334 0.298667 12.8 0.469333 22.997333 0.554667 33.621333a33.962667 33.962667 0 0 1 0.725333 6.656z"/>
  </svg>
 </a>

    
    
    <a href="mailto:2331627921@qq.com" aria-label="Email">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M513.78 602.99c-27.28 0.45-53.79-9.09-74.53-26.83l-65.96-56.64c-15.64-13.37-17.48-36.9-4.1-52.54 13.38-15.65 36.9-17.48 52.54-4.1l65.96 56.64c13.68 11.1 33.27 11.1 46.95 0L881.2 253.08l-708.02-2.61c-20.58 0-37.26-16.69-37.26-37.26s16.68-37.26 37.26-37.26H881.2c41.09-2.36 76.32 29.05 78.67 70.14a74.519 74.519 0 0 1-32.46 65.87L580.86 578.38a111.842 111.842 0 0 1-67.08 24.61z m444.57 133.4V438.28c0-20.58-16.68-37.26-37.26-37.26s-37.26 16.69-37.26 37.26V736.4c0 20.58-16.68 37.26-37.26 37.26h-521.7c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h521.7c61.72 0.01 111.78-50.05 111.78-111.79zM362.12 363.75c0-20.58-16.68-37.26-37.26-37.26h-223.6c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h223.59c20.58 0.01 37.27-16.68 37.27-37.26z m0 298.12c0-20.58-16.68-37.26-37.26-37.26h-111.8c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h111.79c20.58 0 37.27-16.69 37.27-37.26z"/>
  </svg>
</a>

    
    
    
    
    
    
    
    
    
  <p>
    <br>
  <p id="hitokoto">:D è·å–ä¸­...</p>
  <script src="https://v1.hitokoto.cn/?c=a&encode=js&select=%23hitokoto" defer></script>
  <br>
  <p class="center font">
    &copy - <a href="https://UndertaK33r.github.io">UndertaK33r</a> -  2025 - Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/pcrab/hexo-theme-quark"> Quark </a> 
  </p>
  
  <br />
</foot>
  
  <!-- particles.js åˆå§‹åŒ–è„šæœ¬ -->
  <script>
    // particles.js é…ç½® - é€‚åº¦å¢å¼ºç²’å­æ•ˆæœ
    particlesJS('particles-js', {
      "particles": {
        "number": {
          "value": 55,  /* é€‚åº¦å¢åŠ ç²’å­æ•°é‡ */
          "density": {
            "enable": true,
            "value_area": 1000  /* é€‚åº¦å¢åŠ å¯†åº¦ */
          }
        },
        "color": {
          "value": "#7dd3fc"
        },
        "shape": {
          "type": "circle",
          "stroke": {
            "width": 0,
            "color": "#000000"
          }
        },
        "opacity": {
          "value": 0.45,  /* æé«˜é€æ˜åº¦ï¼Œå¢å¼ºå¯è§åº¦ */
          "random": true,
          "anim": {
            "enable": true,
            "speed": 0.8,  /* é€‚åº¦åŠ å¿«é€æ˜åº¦å˜åŒ– */
            "opacity_min": 0.1,
            "sync": false
          }
        },
        "size": {
          "value": 2,  /* é€‚åº¦å¢å¤§ç²’å­å°ºå¯¸ */
          "random": true,
          "anim": {
            "enable": true,
            "speed": 1.2,  /* åŠ å¿«å¤§å°å˜åŒ– */
            "size_min": 0.3,
            "sync": false
          }
        },
        "line_linked": {
          "enable": true,
          "distance": 130,  /* å¢åŠ è¿æ¥è·ç¦»ï¼Œæ›´å®¹æ˜“å½¢æˆç½‘ç»œ */
          "color": "#7dd3fc",
          "opacity": 0.25,  /* é€‚åº¦æé«˜è¿æ¥çº¿é€æ˜åº¦ */
          "width": 1
        },
        "move": {
          "enable": true,
          "speed": 1.2,  /* é€‚åº¦åŠ å¿«ç§»åŠ¨é€Ÿåº¦ */
          "direction": "none",
          "random": true,
          "straight": false,
          "out_mode": "out",
          "bounce": false,
          "attract": {
            "enable": false,
            "rotateX": 600,
            "rotateY": 1200
          }
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": {
            "enable": true,
            "mode": "grab"  /* ä¿æŒé¼ æ ‡äº¤äº’ */
          },
          "onclick": {
            "enable": true,  /* é‡æ–°å¯ç”¨ç‚¹å‡»äº¤äº’ï¼Œå¢åŠ äº’åŠ¨æ€§ */
            "mode": "push"
          },
          "resize": true
        },
        "modes": {
          "grab": {
            "distance": 150,  /* å¢åŠ æŠ“å–è·ç¦» */
            "line_linked": {
              "opacity": 0.5  /* æŠ“å–æ—¶çº¿æ¡æ›´æ˜æ˜¾ */
            }
          },
          "bubble": {
            "distance": 100,
            "size": 40,
            "duration": 2,
            "opacity": 8,
            "speed": 3
          },
          "repulse": {
            "distance": 200,
            "duration": 0.4
          },
          "push": {
            "particles_nb": 3  /* ç‚¹å‡»æ—¶æ·»åŠ 3ä¸ªç²’å­ */
          },
          "remove": {
            "particles_nb": 2
          }
        }
      },
      "retina_detect": true
    });
  </script>
</body>

</html>